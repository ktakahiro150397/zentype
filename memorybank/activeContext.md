# ZenType アクティブコンテキスト

## 現在の作業フォーカス
**🎌 日本語 + ローマ字入力対応の設計決定 - 多言語タイピング練習への拡張！**

## 次のアクション

### 🎯 日本語入力システム設計・実装
**優先項目:**
1. **データ構造の統一設計**
   - TypingTextインターフェースの拡張（displayText/inputText分離）
   - 言語別入力処理エンジンの設計
2. **ローマ字変換システム**
   - 変換テーブルの拡張可能設計
   - 複数入力パターン対応（促音処理等）
3. **段階的実装**
   - Phase 1: 基本的な1対1変換
   - Phase 2: 促音の基本対応（kk, tt等）
   - Phase 3: 複数パターン対応（ltu, xtu等）

### 🚀 本番環境統合の準備（後回し）
- Supabase統合の最終テスト
- Googleログイン機能の動作確認
- デプロイ準備とパフォーマンス最適化

## 最新の状況（2025/05/29 更新）

### 🌟 日本語 + ローマ字入力対応方針決定
**設計コンセプト:**
```typescript
interface TypingText {
  id: string
  displayText: string    // 表示用: "今日はいい天気" or "Hello World"
  inputText: string      // 入力対象: "きょうはいいてんき" or "Hello World"
  language: 'japanese' | 'english'
  difficulty: number
}
```

**重要な考慮事項:**
- ✅ 英文・日本語の統一データ構造で対応
- ✅ 言語別の入力処理エンジン分離
- ✅ 変換テーブルの拡張可能設計
- ✅ 複数入力パターン対応（例：「すてっき」→ "sutekki" or "suteltuki"）
- ✅ 促音（っ）の特殊処理考慮
- ✅ 段階的実装でリスク軽減

**技術的課題:**
- 1文字対1文字の対応では処理不可（促音等の特殊ケース）
- 前処理でひらがな→ローマ字変換が必要
- 文字位置マッピングの管理
- リアルタイム入力判定の複雑化

**実装優先順位:**
1. 基本的なひらがな→ローマ字変換
2. 促音の基本対応
3. 複数入力パターンのサポート

### 🌟 キー入力システム改善作業開始
**改善目標:**
- ❌ 現在のテキストボックス入力方式を廃止
- ✅ onKeyDownによる直接キー入力処理に変更
- ✅ バックスペース機能を無効化（ミスタイプ時は正しいキーまで待機）
- ✅ コンポーネントレベルでのフォーカス管理（ページ全体への影響回避）
- ✅ フォーカス状態の視覚的フィードバック強化

### 🌟 キー入力システム改善完了！
**実装済み改善:**
- ✅ テキストボックス入力方式を廃止
- ✅ onKeyDownによる直接キー入力処理に変更
- ✅ バックスペース機能を無効化（ミスタイプ時は正しいキーまで待機）
- ✅ コンポーネントレベルでのフォーカス管理（ページ全体への影響回避）
- ✅ フォーカス状態の視覚的フィードバック強化
- ✅ エラー時のアニメーション表示とガイドメッセージ
- ✅ 日本語でのわかりやすいユーザー指示

**UI/UX改善（キャプション系統）:**
- ✅ 高速フェードアニメーション（duration-200）でキビキビした動作
- ✅ キャプションを画面下部に移動してタイピングエリアをすっきりと
- ✅ 「上のタイピングエリアをクリックして開始」の明確な指示
- ✅ 背景色・ボーダー付きで視認性向上
- ✅ タイピング開始時のガタつき完全解消
- ✅ より集中しやすいUI設計

**技術的変更点:**
- input要素を削除してdivベースのキー入力に変更
- tabIndex={0}でコンポーネントにフォーカス可能に
- キーダウンイベントで文字単位の入力処理
- エラー時の停止機能（次の文字に進まない）
- フォーカス状態に応じたボーダー・背景色変更
- currentIndexによる正確なカーソル位置管理
- 高速フェード（200ms）とmax-heightアニメーション
**実装済み機能:**
- ✅ 統一サービス層（IDataService、IAuthService）完全実装
- ✅ 環境自動切り替え（NEXT_PUBLIC_DEMO_MODE）動作確認
- ✅ デモモード: ローカルストレージ + モック認証完全動作
- ✅ レスポンシブUI改善（テキスト折り返し、統計表示）
- ✅ 全コンポーネント統一サービス対応
- ✅ タイピング練習コア機能完全動作

## 重要な設計判断

### アーキテクチャ戦略
- **環境分離**: 一つの環境変数で完全切り替え
- **型安全性**: 全サービスで同一インターフェース
- **テスト容易性**: 外部依存なしで完全動作

### データ戦略
- **デモモード**: localStorage（最大100結果保持）
- **本番モード**: Supabase（無制限）
- **型統一**: SessionResult、PracticeText共通

## 現在の状況
- ✅ 環境切り替えシステム完成
- ✅ デモモード完全動作
- ✅ エラー修正完了
- 🔄 本番Supabase統合（次のステップ）

## 次のアクション

### MVP機能スコープ確定
**必須機能:**
- Googleログイン/ログアウトのみ（メール/パスワードは除外）
- 標準練習モード（1つのテキストセット）
- 練習中のリアルタイム表示（WPM、正打率、ミス表示）
- 練習結果表示
- 成績履歴のシンプルなテーブル表示
- 基本的なキーボードショートカット

**後回し機能:**
- 複数の練習モード
- ダッシュボード・グラフ
- 詳細な分析機能
- 称号・ランキング
- AI機能

### キーボードフレンドリー設計の明確化
- 「全操作」ではなく「頻繁に使う操作」にフォーカス
- 練習開始: Enter
- 練習中断/終了: Esc  
- 次の練習: Tab（結果画面から）
- モード切り替え: 数字キー（将来）
- 設定画面: ?

### データ保存粒度の決定
- **リアルタイム**: メモリ上のみ、画面表示用
- **永続化**: セッション終了時の最終結果のみ
- 詳細なキーイベント履歴は保存しない（パフォーマンス重視）

## 重要な設計判断

### 認証戦略
- Googleログインのみに絞ることで実装コストを大幅削減
- メール/パスワード認証は複雑性が高い（パスワード再設定等）

### 成績表示戦略  
- ダッシュボードは後回し、シンプルなテーブル表示でスタート
- まずは記録の蓄積が重要

### AI機能の判断
- 苦手分析AI機能は後回しに決定
- 単純な統計分析から開始

## 次のアクション
1. Next.jsプロジェクトのセットアップ
2. Supabaseプロジェクト作成・設定
3. 基本的な認証フロー実装
4. タイピング練習コンポーネントの実装

## 学んだこと・注意点
- MVP範囲を絞ることで実装の複雑性を大幅に削減できる
- Supabaseの選択により認証・DB・APIの統合開発が可能
- キーボードフレンドリーは段階的に実装する方針が現実的
